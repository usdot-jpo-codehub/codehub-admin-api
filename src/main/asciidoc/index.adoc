:toc: left
:toclevels: 4


= ITS CodeHub

== Admin API
`version: 2.0.0`

The Admin API of CodeHub has the function to administer the metadata information for the CodeHub Ingestion system. The API connect to an https://www.elastic.co/products/enterprise-search[ElasticSearch] storage system

=== Change Log
Changes related to the previous version.

`Previous version: 1.0.0`

* Structure of CHRepository change due a consolidation of Indexes in the Elasticsearch.




== Header token validation
The API is expeting to receive a TOKEN in the header under the name CHTOKEN. This value needs to be provided as part of the configuration of the API.
Failing to provide the CHTOKEN will return in UNAUTHORIZED.

include::{snippets}/api/v1/invalid-token/http-response.adoc[]

== Repository

The repository information is presented through an structure (CHRepository) that contains the following properties.

*CHRespository*
[options="header",cols="1,1,2"]
|===
|Name   |Type   |Description
//-------------
|id   |String   |Unique hash ID
|sourceData   |*CHSourceData*   |Data provided by the source (github).
|generatedData   |*CHGeneratedData*   |Data generated by external system (sonar, virus scan).
|codehubData   |*CHCodehubData*   |Data related to Codehub Repository administration.
|===

*CHSourceData*
[options="header",cols="1,1,2"]
|===
|Name   |Type   |Description
//-------------
|name   |String   |Name of the repository
|repositoryUrl|String   |URL of the repository.
|owner   |*CHOwner*   |Structure that handles Owner information.
|===

*CHOwner*
[options="header",cols="1,1,2"]
|===
|Name   |Type   |Description
//-------------
|name   |String   |Name of the owner.
|===

*CHGeneratedData*
[options="header",cols="1,1,2"]
|===
|Name   |Type   |Description
//-------------
|rank   |long   |Repository rank (placeholder).
|===

*CHCodehubData*
[options="header",cols="1,1,2"]
|===
|Name   |Type   |Description
//-------------
|etag   |String   |Hash value that allows to detect whether the repository has changes.
|isVisible|boolean|Make the repository visible in the user interface.
|isIngested|boolean|Indicates that the repository was ever Ingested.
|isIngestionEnabled|boolean|Set the repository to be processed by the Ingestion system.
|source|String|Source of the repository (github).
|lastModified|Date|Date of the last modification of the metadata information for the repository.
|lastIngested|Date|Date when was the last time that the repository was Ingested.
|badges|*CHBadges*|Structure that contains information about repository Badges.
|===

*CHBadges*
[options="header",cols="1,1,2"]
|===
|Name   |Type   |Description
//-------------
|isFeatured|boolean|Sets whether he repository will be displayed in the Featured are in the user interface.
|status|String|Status of the repository.
|===


=== List Repositories
Gets a list of all the Repositories

==== Request
include::{snippets}/api/v1/repositories/get-data/http-request.adoc[]

===== cURL Sample
include::{snippets}/api/v1/repositories/get-data/curl-request.adoc[]


==== Response

===== Data available
include::{snippets}/api/v1/repositories/get-data/http-response.adoc[]

===== No data available
include::{snippets}/api/v1/repositories/get-no-data/http-response.adoc[]

===== Error
include::{snippets}/api/v1/repositories/get-error/http-response.adoc[]

=== Add Repository
Adds a Repository.

==== Request
include::{snippets}/api/v1/repositories/add-ok/http-request.adoc[]

===== cURL Sample
include::{snippets}/api/v1/repositories/add-ok/curl-request.adoc[]


==== Response

===== Success
include::{snippets}/api/v1/repositories/add-ok/http-response.adoc[]

===== Conflict
include::{snippets}/api/v1/repositories/add-conflict/http-response.adoc[]

===== Error
include::{snippets}/api/v1/repositories/add-error/http-response.adoc[]


=== Update Repository
Updates a Repository.

==== Request
include::{snippets}/api/v1/repositories/update-ok/http-request.adoc[]

===== cURL Sample
include::{snippets}/api/v1/repositories/update-ok/curl-request.adoc[]


==== Response

===== Success
include::{snippets}/api/v1/repositories/update-ok/http-response.adoc[]

===== Error
include::{snippets}/api/v1/repositories/update-error/http-response.adoc[]


=== Delete Repository
Delete a Repository.

==== Request
include::{snippets}/api/v1/repositories/deleteOne-ok/http-request.adoc[]

===== cURL Sample
include::{snippets}/api/v1/repositories/deleteOne-ok/curl-request.adoc[]


==== Response

===== Success
include::{snippets}/api/v1/repositories/deleteOne-ok/http-response.adoc[]

===== Not found
include::{snippets}/api/v1/repositories/deleteOne-not-found/http-response.adoc[]

===== Error
include::{snippets}/api/v1/repositories/deleteOne-error/http-response.adoc[]


=== Delete Multiple Repositories
Delete multiple repositories

==== Request
include::{snippets}/api/v1/repositories/deleteMany-ok/http-request.adoc[]

===== cURL Sample
include::{snippets}/api/v1/repositories/deleteMany-ok/curl-request.adoc[]


==== Response

===== Success
include::{snippets}/api/v1/repositories/deleteMany-ok/http-response.adoc[]

===== Error
include::{snippets}/api/v1/repositories/deleteMany-error/http-response.adoc[]


=== Reset Cache
Reset Repository Cache.

==== Request
include::{snippets}/api/v1/repositories/resetcache-ok/http-request.adoc[]

===== cURL Sample
include::{snippets}/api/v1/repositories/resetcache-ok/curl-request.adoc[]


==== Response

===== Success
include::{snippets}/api/v1/repositories/resetcache-ok/http-response.adoc[]

===== Error
include::{snippets}/api/v1/repositories/resetcache-error/http-response.adoc[]

